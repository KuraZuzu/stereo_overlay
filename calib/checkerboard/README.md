# Checkerboard HTML を使ったキャリブレーションボード表示手順（Ubuntu 24.04 + Google Chrome）

この README は、前のメッセージで提示した **チェッカーボード表示用 HTML**（`checkerboard.html`）を、
ノートPCの **サブモニタ（外部ディスプレイ）** に全画面表示し、カメラキャリブレーション用の撮影に使うための手順書です。

---

## 目的

- 印刷が難しい大判のチェッカーボードの代わりに、外部ディスプレイに **実寸（mm）** でチェッカーボードを表示して使う
- 表示の拡大縮小（OSスケーリング / TVのオーバースキャン / ブラウザ倍率）に左右されないように、HTML内の **Ruler（100mm）** を使って **実測で校正**する

---

## 前提

- OS: Ubuntu 24.04
- ブラウザ: Google Chrome
- 外部ディスプレイ: （例）4K 3840×2160、実寸 1650.0mm × 928.0mm（ユーザー提示値）
- カメラ: HFOV 126°、撮影 720p 程度を想定（※キャリブ側の話。表示側は4KでOK）

---

## 用意するファイル

- `display_checker_board.html`

---

## 1. 外部ディスプレイ側の設定（重要）

表示が「実寸」になるかどうかは、ここが一番重要です。

### 1-1. Ubuntu のディスプレイ設定

1. **設定** → **ディスプレイ** を開く  
2. 対象の外部ディスプレイを選択  
3. 可能なら以下を推奨
   - **スケーリング: 100%**
   - 解像度: ディスプレイのネイティブ（例: 3840×2160）
   - リフレッシュレート: 任意（60Hzなど）

> スケーリングが100%でなくても動きますが、その場合は **HTML内の Scale** で必ず実測合わせしてください。

### 1-2. TV/モニタ側のオーバースキャン（ある場合）

TV等では「画面を少し拡大して表示」する機能があり、これがONだと **mmがズレます**。

- メニューで以下のような項目を探し、**OFF/無効** にしてください  
  - オーバースキャン / Overscan  
  - 画面サイズ自動拡大  
  - Just Scan / Screen Fit / Dot by Dot / 1:1  
  - フルピクセル表示

---

## 2. HTML の保存

任意のフォルダに `display_checkerboard.html` を保存します。

例:
```bash
mkdir -p ~/calib_board
cd ~/calib_board
# ここに display_checkerboard.html を保存
```

---

## 3. Chrome で開いて全画面表示

### 3-1. 通常表示で開く

ファイルを直接開きます（どちらでもOK）。

- ファイルマネージャで `display_checkerboard.html` をダブルクリック
- もしくはターミナルで:

```bash
google-chrome /path/to/display_checkerboard.html
```

### 3-2. 全画面表示（推奨）

- **F11** を押す（ブラウザのUIが消えて全画面になります）
- もしくは HTML画面内の **Enter Fullscreen** ボタンを押す

> 終了は **F11** でもう一度切り替えできます。

### 3-3. さらにUIを消す（キオスクモード）

アドレスバー等を完全に消したい場合:

```bash
google-chrome --kiosk file:///home/(中略)/checkerboard/display_checkerboard.html
```

---

## 4. 実寸合わせ（最重要ステップ）

HTML左上に **Ruler: 100 mm** の定規が表示されます（初期設定で表示ON）。

1. 物理定規で **100mmのバー**を測ります  
2. 実測が100mmになっていない場合、左下パネルの **Scale** を調整します
   - 例: 実測が 98mm（短い）なら → Scale を少し **上げる**
   - 例: 実測が 102mm（長い）なら → Scale を少し **下げる**

> **コツ**  
> - `+` / `-` キーでも Scale を微調整できます（1回で 0.005 ずつ）  
> - まずは100mmが一致するまで Scale を合わせ、その後にセルサイズ(mm)を調整します。

---

## 5. チェスボード設定（セルサイズ / コーナー数）

### 5-1. 入力項目の意味（OpenCV基準）

- **Inner corners X/Y**  
  - OpenCV の `findChessboardCorners()` 等で指定する **内部コーナー数**  
- **Cell size (mm)**  
  - 1セル（1マス）の1辺の実寸（mm）

### 5-2. 推奨初期値（今回のディスプレイ条件向け）

外部ディスプレイ（1650×928mm）を想定した「安定寄り」設定の例:

- **Inner corners**: `7 × 4`（セルは `8 × 5`）
- **Cell size (mm)**: `186.0`

※もちろん、後から変更可能です。

---

## 6. 撮影時の運用（例：まずはこれでOK）

### 6-1. 推奨枚数

- **30枚**（最低でも20枚）

### 6-2. 推奨距離（表示ターゲットは固定でOK、カメラを動かす）

- 2.0〜2.5m を多めに撮る  
- 3.0m を混ぜる

（3mのみでも可能ですが、2〜2.5mを混ぜると検出が安定しやすいです）

### 6-3. 推奨姿勢（重要：正面だけはNG）

- 正面〜軽い傾き（10枚）
- 強めの傾き（10枚）
- ロール（回転）を入れる（10枚）
- 画面の四隅にチェスボードが来る構図を必ず混ぜる

---

## 7. 便利なショートカット（HTML内）

- `H` : パネル表示/非表示
- `R` : 100mm定規 表示/非表示
- `I` : 白黒反転
- `+` / `-` : Scale を微調整
- 矢印キー : チェスボードを少し移動（画面端に寄せたいとき）
- `0` : 移動オフセットをリセット
- `F` : Fullscreen API の切替（環境によっては F11 の方が確実）

---

## 8. ありがちなトラブルと対処

### 8-1. 定規がどうしても実測と合わない
- Ubuntu側のスケーリング（100%以外）や、TV側のオーバースキャンが原因のことが多いです
- それでも、**Scale**で最終的に一致させればOKです

### 8-2. 縞（フリッカ）やモアレでコーナー検出が不安定
- シャッターを短くする、露光を固定する
- 反射が強いなら照明を調整、角度を変える
- 必要なら、わずかにデフォーカスしてモアレを抑えることも有効です

### 8-3. ボードが画面に収まらない
- Cell size (mm) を下げるか、Inner corners を減らす
- ただし「セルが小さすぎる」と検出が不安定になるため、バランスを見て調整してください

---

## 補足：この方式のメリット/デメリット

### メリット
- 大判印刷が不要
- セルサイズを即座に変更できる
- 実測でmm合わせが可能

### デメリット
- TV/モニタの表示処理（オーバースキャン/補間）に影響される可能性がある
- 反射やフリッカがある環境では工夫が必要

---

## 最後に
**まずは「Ruler 100mmが実測100mmになるように Scale を合わせる」**、これが全ての出発点です。  
ここが揃えば、セルサイズ(mm)を変えても「実寸のターゲット」として使えます。
